<div class="max-w-3xl">
  <h1 class="text-xl font-semibold mb-4"><%= @product.name %></h1>

  <div class="mb-6">
    <h2 class="font-medium mb-2">Tags</h2>
    <%= form_with model: @product, method: :patch do |f| %>
      <div class="flex flex-wrap gap-2 mb-2">
        <% @available_tags.each do |t| %>
          <label class="inline-flex items-center gap-1">
            <%= check_box_tag 'product[tag_ids][]', t.id, @product.tags.exists?(t.id) %>
            <span class="px-2 py-0.5 bg-gray-100 rounded text-sm"><%= t.name %></span>
          </label>
        <% end %>
      </div>
      <%= f.submit 'Save tags', class: 'px-3 py-1 bg-blue-600 text-white rounded' %>
    <% end %>
  </div>

  <div>
    <h2 class="font-medium mb-2">Batches</h2>
    <div class="divide-y mb-3">
      <% @batches.each do |b| %>
        <div class="flex items-center justify-between py-2">
          <div>
            <div class="font-medium">Qty: <%= b.qty %></div>
            <div class="text-sm text-gray-600">Expiry: <%= b.expiry_date || '-' %> â€¢ Lot: <%= b.lot_code || '-' %></div>
          </div>
          <%= button_to 'Delete', product_batch_path(@product, b), method: :delete, class: 'text-red-600 text-sm' %>
        </div>
      <% end %>
    </div>

    <%= form_with url: product_batches_path(@product), method: :post do |f| %>
      <div class="flex gap-2">
        <%= hidden_field_tag 'batch[folder_id]', @product.folder_id %>
        <%= number_field_tag 'batch[qty]', 0, class: 'border px-2 py-1 rounded w-24' %>
        <%= date_field_tag 'batch[expiry_date]', nil, class: 'border px-2 py-1 rounded' %>
        <%= text_field_tag 'batch[lot_code]', nil, placeholder: 'Lot code', class: 'border px-2 py-1 rounded' %>
        <%= f.submit 'Add batch', class: 'px-3 py-1 bg-gray-800 text-white rounded' %>
      </div>
    <% end %>
  </div>
</div>
