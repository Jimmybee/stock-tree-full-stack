<div class="divide-y">
  <% (local_assigns[:products] || @products).each do |p| %>
      <div class="flex items-center gap-3 py-2">
        <div class="w-12 h-12 bg-gray-100 rounded overflow-hidden">
          <% if p.product_image.attached? %>
            <%= image_tag url_for(p.product_image), class: "w-full h-full object-cover" %>
          <% end %>
        </div>
        <div class="flex-1">
          <div class="font-medium"><%= p.name %></div>
          <div class="text-sm text-gray-600">Qty: <%= p.qty %></div>
        </div>
        <div class="text-xs text-gray-500">
          <% p.tags.limit(3).each do |t| %>
            <span class="px-2 py-0.5 bg-gray-100 rounded"><%= t.name %></span>
          <% end %>
        </div>
      </div>
  <% end %>
</div>

<div class="mt-3">
  <% if defined?(@pagy) && @pagy %>
    <%# Make pagy links update just the products_list frame %>
    <%== pagy_nav(@pagy, link_extra: 'data-turbo-frame="products_list"') %>
  <% else %>
    <% page = local_assigns[:page] || 1 %>
    <% has_next = local_assigns[:has_next] || false %>
    <% folder = local_assigns[:folder] %>
    <div class="flex items-center gap-2 text-sm">
      <% if page.to_i > 1 %>
        <%= link_to 'Prev', folder_path(folder, page: page.to_i - 1), class: 'px-2 py-1 border rounded' %>
      <% end %>
      <% if has_next %>
        <%= link_to 'Next', folder_path(folder, page: page.to_i + 1), class: 'px-2 py-1 border rounded' %>
      <% end %>
    </div>
  <% end %>
</div>
